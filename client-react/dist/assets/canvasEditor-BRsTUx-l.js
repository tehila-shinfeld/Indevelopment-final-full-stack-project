import{a as f,r as i,j as e,D as ot,X as ct,S as it}from"./index-D4Ut40ie.js";/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],rt=f("bold",at);/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]],dt=f("eraser",lt);/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=[["rect",{x:"5",y:"2",width:"14",height:"20",rx:"7",key:"11ol66"}],["path",{d:"M12 6v4",key:"16clxf"}]],ht=f("mouse",ut);/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],ft=f("palette",xt);/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],vt=f("redo",mt);/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]],pt=f("type",gt);/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],jt=f("undo",yt),Ct=({onSave:L,onCancel:B,initialText:p})=>{const d=i.useRef(null),y=i.useRef(null),[$,T]=i.useState(!1),[a,j]=i.useState("text"),[b,U]=i.useState("#000000"),[_,W]=i.useState(3),[w,q]=i.useState(p),[m,P]=i.useState([]),[h,C]=i.useState(-1),[u,X]=i.useState({width:800,height:600}),[v,A]=i.useState(16),[g,K]=i.useState(!1),[l,E]=i.useState(null),[O,Y]=i.useState(new Map);i.useEffect(()=>{const t=()=>{const n=document.querySelector(".canvas-container");if(n){const s=n.clientWidth-40,c=Math.min(window.innerHeight*.7,600);X({width:Math.min(s,800),height:c})}};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),i.useEffect(()=>{const t=d.current;if(!t)return;t.width=u.width,t.height=u.height;const n=t.getContext("2d");n&&(n.fillStyle="#ffffff",n.fillRect(0,0,t.width,t.height),p&&D(n,p),k())},[u,p]);const D=(t,n)=>{const s=n.split(`
`),c=v+8,r=20;let o=r+v;s.forEach(z=>{if(o<u.height-r){const M=g?"bold":"normal";t.font=`${M} ${v}px Arial, sans-serif`,t.fillStyle=b,t.textAlign="right",t.direction="rtl";const st=z.split(" ");let x="";st.forEach(F=>{const H=x+F+" ";t.measureText(H).width>u.width-r*2&&x!==""?(t.fillText(x.trim(),u.width-r,o),x=F+" ",o+=c):x=H}),x.trim()!==""&&(t.fillText(x.trim(),u.width-r,o),o+=c)}})},k=i.useCallback(()=>{const t=d.current;if(!t)return;const n=t.getContext("2d");if(!n)return;const s=n.getImageData(0,0,t.width,t.height),c=m.slice(0,h+1);c.push(s),P(c),C(c.length-1)},[m,h]),V=()=>{if(h>0){const t=d.current;if(!t)return;const n=t.getContext("2d");if(!n)return;const s=h-1;n.putImageData(m[s],0,0),C(s)}},G=()=>{if(h<m.length-1){const t=d.current;if(!t)return;const n=t.getContext("2d");if(!n)return;const s=h+1;n.putImageData(m[s],0,0),C(s)}},J=t=>{if(a==="text"||a==="select")return;T(!0);const n=d.current;if(!n)return;const s=n.getBoundingClientRect(),c=t.clientX-s.left,r=t.clientY-s.top,o=n.getContext("2d");o&&(o.beginPath(),o.moveTo(c,r))},Q=t=>{if(!$||a==="text"||a==="select")return;const n=d.current;if(!n)return;const s=n.getBoundingClientRect(),c=t.clientX-s.left,r=t.clientY-s.top,o=n.getContext("2d");o&&(o.lineWidth=_,o.lineCap="round",a==="pen"?(o.globalCompositeOperation="source-over",o.strokeStyle=b):a==="eraser"&&(o.globalCompositeOperation="destination-out"),o.lineTo(c,r),o.stroke(),o.beginPath(),o.moveTo(c,r))},R=()=>{$&&(T(!1),k())},N=()=>{const t=y.current;if(!t)return;const n=t.selectionStart,s=t.selectionEnd;if(n!==s){const c=w.substring(n,s);E({start:n,end:s,text:c})}else E(null)},S=t=>{if(!l||!y.current)return;const n=y.current,{start:s,end:c}=l,r=`${s}-${c}`,z={...O.get(r)||{bold:!1,fontSize:16,color:"#000000"},...t};Y(M=>new Map(M.set(r,z))),I(),setTimeout(()=>{n.setSelectionRange(s,c),n.focus()},0)},I=()=>{const t=d.current;if(!t)return;const n=t.getContext("2d");n&&(n.fillStyle="#ffffff",n.fillRect(0,0,t.width,t.height),D(n,w),k())},Z=()=>{l&&S({bold:!g}),K(!g)},tt=t=>{l&&S({fontSize:t}),A(t)},et=()=>{L(w)},nt=()=>{const t=d.current;if(!t)return;const n=document.createElement("a");n.download="edited-summary.png",n.href=t.toDataURL(),n.click()};return e.jsxs("div",{className:"canvas-editor-container",children:[e.jsxs("div",{className:"canvas-toolbar",children:[e.jsxs("div",{className:"toolbar-section",children:[e.jsx("button",{className:`tool-button ${a==="select"?"active":""}`,onClick:()=>j("select"),title:"בחירת טקסט",children:e.jsx(ht,{size:18})}),e.jsx("button",{className:`tool-button ${a==="text"?"active":""}`,onClick:()=>j("text"),title:"עריכת טקסט",children:e.jsx(pt,{size:18})}),e.jsx("button",{className:`tool-button ${a==="pen"?"active":""}`,onClick:()=>j("pen"),title:"עט",children:e.jsx(ft,{size:18})}),e.jsx("button",{className:`tool-button ${a==="eraser"?"active":""}`,onClick:()=>j("eraser"),title:"מחק",children:e.jsx(dt,{size:18})})]}),e.jsxs("div",{className:"toolbar-section text-formatting",children:[e.jsx("button",{className:`format-button ${g?"active":""}`,onClick:Z,disabled:!l,title:"הדגשה",children:e.jsx(rt,{size:18})}),e.jsxs("select",{value:v,onChange:t=>tt(Number(t.target.value)),className:"font-size-selector",disabled:!l&&a!=="text",title:"גודל גופן",children:[e.jsx("option",{value:12,children:"12"}),e.jsx("option",{value:14,children:"14"}),e.jsx("option",{value:16,children:"16"}),e.jsx("option",{value:18,children:"18"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:24,children:"24"}),e.jsx("option",{value:28,children:"28"}),e.jsx("option",{value:32,children:"32"})]})]}),e.jsxs("div",{className:"toolbar-section",children:[e.jsx("input",{type:"color",value:b,onChange:t=>{U(t.target.value),l&&S({color:t.target.value})},className:"color-picker",title:"בחר צבע"}),e.jsx("input",{type:"range",min:"1",max:"20",value:_,onChange:t=>W(Number(t.target.value)),className:"brush-size",title:"גודל מברשת"})]}),e.jsxs("div",{className:"toolbar-section",children:[e.jsx("button",{onClick:V,disabled:h<=0,className:"tool-button",title:"בטל",children:e.jsx(jt,{size:18})}),e.jsx("button",{onClick:G,disabled:h>=m.length-1,className:"tool-button",title:"חזור",children:e.jsx(vt,{size:18})})]}),e.jsx("div",{className:"toolbar-section",children:e.jsx("button",{onClick:nt,className:"tool-button",title:"הורד",children:e.jsx(ot,{size:18})})}),e.jsxs("div",{className:"toolbar-actions",children:[e.jsxs("button",{onClick:B,className:"cancel-button",children:[e.jsx(ct,{size:18}),e.jsx("span",{children:"ביטול"})]}),e.jsxs("button",{onClick:et,className:"save-button",children:[e.jsx(it,{size:18}),e.jsx("span",{children:"שמור"})]})]})]}),l&&e.jsx("div",{className:"selection-info",children:e.jsxs("span",{children:['נבחר: "',l.text.substring(0,30),l.text.length>30?"...":"",'"']})}),e.jsx("div",{className:"canvas-container",children:e.jsxs("div",{className:"canvas-wrapper",children:[e.jsx("canvas",{ref:d,width:u.width,height:u.height,onMouseDown:J,onMouseMove:Q,onMouseUp:R,onMouseLeave:R,className:`edit-canvas ${a==="text"?"text-mode":""}`}),a==="text"&&e.jsx("div",{className:"text-editor-overlay",children:e.jsx("textarea",{ref:y,value:w,onChange:t=>{q(t.target.value),I()},onSelect:N,onMouseUp:N,onKeyUp:N,className:"text-editor",placeholder:"ערוך את הטקסט כאן...",dir:"rtl",style:{fontSize:`${v}px`,fontWeight:g?"bold":"normal",color:b}})})]})})]})};export{Ct as default};
